;T6 - PROGRAMA LEE NUMERO HEXADECIMAL CON VALIDACION, PROCEDIMIENTOS Y MACROS
;EQUIPO
;TRUJILLO ACOSTA BRYANT No.Control. 21170495
;RUBIO SOTO JESUS GUADALUPE No.Control. 21170471
TITLE LEE_HEX PROGRAMA LEE NUMERO HEXADECIMAL CON VALIDACION, PROCEDIMIENTOS Y MACROS

INIT_DS MACRO
    MOV AX,@DATA
    MOV DS,AX 
ENDM

DOS_RTN MACRO
    MOV AH,4Ch
    INT 21H
ENDM

DISP_ST MACRO ST 
    LEA DX, ST 
    MOV AH, 09
    INT 21h
ENDM

.MODEL SMALL
.STACK 100H
.DATA
    MSG DB 10,13,"DAME UN NÚMERO HEXADECIMAL DE 4 CIFRAS: $"
    MSG2 DB 10,13,"ERROR CARÁCTER NO VALIDO $"
.CODE
MAIN PROC 
    ;INICIALIZAR SEGMENTO DE DATOS
    INIT_DS

    ;MOSTRAR MENSAJE
    DISP_ST MSG

    ;LLAMAR A PROCEDIMIENTO PARA LEER HEXADECIMAL
    CALL LEE_HEX

    ;TERMINAR PROGRAMA
    DOS_RTN
MAIN ENDP
LEE_HEX PROC
    ;LEE UN NUMERO HEXADECIMAL DE HASTA 4 CIFRAS
    MOV CX, 4 ; Número máximo de caracteres
    XOR BX, BX ; Limpiar BX para almacenar el resultado

LEE_BUCLE:
    MOV AH, 01H ; Función para leer un carácter
    INT 21H
    CMP AL, 0DH ; Verificar si es Enter
    JE FIN_LECTURA

    ; Validar carácter
    CMP AL, '0'
    JB ERROR
    CMP AL, '9'
    JBE ALMACENA_DIGITO
    CMP AL, 'A'
    JB ERROR
    CMP AL, 'F'
    JBE ALMACENA_LETRA
    CMP AL, 'a'
    JB ERROR
    CMP AL, 'f'
    JBE ALMACENA_LETRA
    JMP ERROR

ALMACENA_DIGITO:
    SUB AL, '0'
    JMP ALMACENA

ALMACENA_LETRA:
    SUB AL, 'A'
    ADD AL, 10
    JMP ALMACENA

ALMACENA:
    SHL BX, 4 ; Desplazar BX 4 bits a la izquierda
    ADD BX, AX ; Añadir el valor del carácter a BX
    LOOP LEE_BUCLE
    JMP FIN_LECTURA
ERROR:
    DISP_ST MSG2
    JMP MAIN

FIN_LECTURA:
    RET
LEE_HEX ENDP
END MAIN